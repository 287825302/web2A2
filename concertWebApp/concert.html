<!-- <!DOCTYPE html>
<html>
  <head>
      <title>Concert page</title>
  </head>
  <body>
      CONVENTION CENTRE XYZ<br>

      <img src="header.jpg" width="400">

      <h1>Concert page</h1>

      <a href="/"><span>Home</span></a> | <span>Concerts</span>  | <a href="/add_concert"><span>Add a new concert</span></a>

      <input type="button" onclick="loadConcerts();" value="Refresh"><Br>

      <label>ID: </label>
      <input type="text" id="txtID" placeholder="Enter ID" required>
      <input type="button" value="Search" onclick="let txtID=document.getElementById('txtID').value; searchByID(txtID);">


      <div id="data"></div>

      <script>
        function loadConcerts(){
          //call GET API to get a list of Concerts
          fetch("http://localhost:3060/api/concerts")
            .then(response => response.json())
            .then(data => {

              const dataDiv=document.getElementById('data');
              dataDiv.innerHTML="";

              if(data.length>0){
                data.forEach( concert => {
                    const newP=document.createElement("p");
                    newP.textContent=`Concert: ${concert.ArtistName}, Location: ${concert.Location}`;

                    dataDiv.appendChild(newP);

                    //for delete
                    const newP2=document.createElement("p");
                    newP2.innerHTML="<a href='#' onclick='deleteByID("+concert.ConcertID+");'>Delete</a>";
                    dataDiv.appendChild(newP2);
                });

              }
              else{
                dataDiv.textContent="No concert data";
              }
            })
            .catch(error=>{
              console.error("Error fecthing data",error);
              document.getElementById('data').textContent="Failed to load data";
            });
          }

          function searchByID(id){
            //call GET API to get a list of Concerts
            fetch("http://localhost:3060/api/concerts/"+id)
              .then(response => response.json())
              .then(data => {

                const dataDiv=document.getElementById('data');
                dataDiv.innerHTML="";

                if(data.length>0){
                  data.forEach( concert => {
                      const newP=document.createElement("p");
                      newP.textContent=`Concert: ${concert.ArtistName}, Location: ${concert.Location}`;

                      dataDiv.appendChild(newP);
                  });

                }
                else{
                  dataDiv.textContent="No concert data";
                }
              })
              .catch(error=>{
                console.error("Error fecthing data",error);
                document.getElementById('data').textContent="Failed to load data";
              });
            }

            function deleteByID(id){
                // Send DELETE request to API
                fetch('http://localhost:3060/api/concerts/'+id, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                  alert(data.delete);
                    if (data.delete === 'success') {
                        alert("Concert deleted successfully!");
                    } else if (data.delete === 'error') {
                        alert("Error: " + data.message);
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            }

      </script>
  </body>
</html> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Fundraisers</title>
    <style>
        /* 保持原有的样式不变 */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 10px;
        }
        input[type="text"], select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        #errorMessage {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
        .fundraiser {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .fundraiser a {
            color: #4CAF50;
            text-decoration: none;
        }
        .fundraiser a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Search Fundraisers</h1>
        <form id="searchForm">
            <label>
                Organizer:
                <input type="text" id="organizer" name="ORGANIZER">
            </label>
            <label>
                City:
                <input type="text" id="city" name="CITY">
            </label>
            <label>
                Category:
                <select id="category" name="CATEGORY">
                    <option value="">Select a category</option>
                </select>
            </label>
            <button type="submit">Search</button>
            <button type="button" onclick="clearInputs()">Clear</button>
        </form>
        <div id="errorMessage"></div>
        <div id="results"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            loadAllFundraisers();
        });

        function loadCategories() {
            fetch('http://localhost:3060/api/crowdfunding/CATEGORY')
                .then(response => response.json())
                .then(categories => {
                    const categorySelect = document.getElementById('category');
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.NAME;
                        option.textContent = category.NAME;
                        categorySelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading categories:', error);
                });
        }

        function loadAllFundraisers() {
            fetch('http://localhost:3060/api/crowdfunding/FUNDRAISER')
                .then(response => response.json())
                .then(displayResults)
                .catch(error => {
                    console.error('Error loading fundraisers:', error);
                    document.getElementById('errorMessage').textContent = 'An error occurred while loading fundraisers. Please try again.';
                });
        }

        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const organizer = document.getElementById('organizer').value.trim();
            const city = document.getElementById('city').value.trim();
            const category = document.getElementById('category').value;

            let queryParams = [];
            if (organizer) queryParams.push(`ORGANIZER=${encodeURIComponent(organizer)}`);
            if (city) queryParams.push(`CITY=${encodeURIComponent(city)}`);
            if (category) queryParams.push(`CATEGORY=${encodeURIComponent(category)}`);

            const queryString = queryParams.length > 0 ? '?' + queryParams.join('&') : '';

            fetch(`http://localhost:3060/api/crowdfunding/search${queryString}`)
                .then(response => response.json())
                .then(displayResults)
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('errorMessage').textContent = 'An error occurred while searching. Please try again.';
                });
        });

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const errorMessage = document.getElementById('errorMessage');
            
            if (data.length === 0) {
                errorMessage.textContent = 'No fundraisers found.';
                resultsDiv.innerHTML = '';
            } else {
                errorMessage.textContent = '';
                resultsDiv.innerHTML = data.map(f => `
                    <div class="fundraiser">
                        <h3><a href="/fundraiser?id=${f.FUNDRAISER_ID}">${f.CAPTION}</a></h3>
                        <p>Organizer: ${f.ORGANIZER}</p>
                        <p>City: ${f.CITY}</p>
                        <p>Category: ${f.CATEGORY}</p>
                        <p>Target: ${f.TARGET_FUNDING} AUD | Raised: ${f.CURRENT_FUNDING} AUD</p>
                    </div>
                `).join('');
            }
        }

        function clearInputs() {
            document.getElementById('organizer').value = '';
            document.getElementById('city').value = '';
            document.getElementById('category').value = '';
            document.getElementById('errorMessage').textContent = '';
            loadAllFundraisers();
        }
    </script>
</body>
</html>




